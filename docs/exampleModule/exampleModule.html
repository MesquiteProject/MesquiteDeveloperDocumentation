<!--This file created 4.4.99 11:52 AM by Claris Home Page version 2.0--><html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="generator" content="Adobe GoLive 4">		<title>Example module (Source code)</title>		<x-sas-window top="88" bottom="686" left="121" right="817">	</head>	<body bgcolor="#ffe4b5">		<table border="0" cellpadding="0" cellspacing="0">			<tr>				<td bgcolor="black"><img src="../images/devIcon.gif"></td>				<td>					<table border="0" cellpadding="0" cellspacing="1" width="75">						<tr>							<td><font color="#009999">								<table width="636" border="1" cellpadding="0" cellspacing="1">									<tr>										<td align="center"><a href="../Mesquite_development.html"><font color="#330099">General</font></a></td>										<td align="center"><a href="../modularity/architecture.html"><font color="#330099">Modularity</font></a></td>										<td align="center" bgcolor="#66ff66"><a href="exampleIntro.html"><font color="#330099">Example Module</font></a></td>										<td align="center"><a href="../files/files.html"><font color="#330099">Projects &amp; Files</font></a></td>										<td align="center"><font color="#330099"><a href="../commands/commands.html">Commands &amp; Scripting</a></font></td>									</tr>									<tr>										<td align="center"><a href="../windows.html"><font color="#330099">Windows</font></a></td>										<td align="center"><a href="../menus.html"><font color="#330099">Menus</font></a></td>										<td align="center"><a href="../charts/charts.html"><font color="#330099">Charts</font></a></td>										<td align="center"><a href="../tables/tables.html"><font color="#330099">Tables</font></a></td>										<td align="center"><a href="../buttons_and_tools.html"><font color="#330099">Buttons &amp; tools</font></a></td>									</tr>									<tr>										<td align="center"><a href="../treesTaxa/trees.html"><font color="#330099">Trees and Taxa</font></a></td>										<td align="center"><a href="../characters/character_data.html"><font color="#330099">Characters &amp; Models</font></a></td>										<td align="center"><a href="../documentation.html"><font color="#330099">Documentation</font></a></td>										<td align="center"><a href="../Utilities.html"><font color="#330099">General Utilities</font></a></td>										<td align="center"></td>									</tr>								</table>								</font></td>						</tr>						<tr>							<td>								<table border="1" cellpadding="0" cellspacing="1" width="636">									<tr>										<td bgcolor="#66ff66"><img height="12" width="7" src="../images/raindrop.gif"> <a href="exampleIntro.html">Introduction</a> <img height="12" width="7" src="../images/raindrop.gif"> <a href="exampleModule.html">The module's source code</a> <img height="12" width="7" src="../images/raindrop.gif"> <a href="exampleEmployment.html">Employing other modules</a> <img height="12" width="7" src="../images/raindrop.gif"> <a href="exampleMenus.html">Menus</a><br>											<img height="12" width="7" src="../images/raindrop.gif"> <a href="exampleCommands.html">Commands &amp; snapshots</a> <img height="12" width="7" src="../images/raindrop.gif"> <a href="exampleautodoc.html">Automatic documentation generation</a> <img height="12" width="7" src="../images/raindrop.gif"> <a href="exampleWindows.html">Windows</a></td>									</tr>								</table>							</td>						</tr>					</table>				</td>			</tr>		</table>		<h2>An example module: Source code</h2>		<p>(updated August 2005)</p>		<p>Here is the source code for a fairly complex module that presents and controls a window (the Baby Tree Window). It illustrates <a href="exampleEmployment.html">how modules employ other modules</a>, the use of <a href="exampleMenus.html">menus</a>, <a href="exampleCommands.html">commands &amp; snapshots</a>, <a href="exampleWindows.html">windows</a>, and features for <a href="exampleautodoc.html">automatic documentation</a>.</p>		<p>This source code may not be the latest version. Check the newest source code   in <a href="../mesquite.examples/mesquite/examples/BabyTreeWindow/BabyTreeWindow.java">mesquite.examples.BabyTreeWindow</a></p>		<p>		<hr>		</p>		<pre>package mesquite.examples.BabyTreeWindow;import java.applet.*;import java.awt.*;import mesquite.lib.*;import mesquite.lib.duties.*;<font color="red">/*========================================*/</font><font color="red">/*A simple example module that displays a tree window that depends on a tree in a standard tree window*/</font>public class <b>BabyTreeWindow</b> extends TreeWindowAssistantN {    DrawTreeCoordinator treeDrawCoordTask;    NumberForTree numberTask;    BTreeWindow bTreeWindow;       <font color="red"> /*--------------------------------------*/</font><font color="red">    /*The basic substitute for a constructor for modules  <b>(overrides method of MesquiteModule)</b>*/</font>    public boolean <b>startJob</b>(String arguments, Object condition, CommandRecord commandRec, boolean hiredByName) {        treeDrawCoordTask= (DrawTreeCoordinator)hireEmployee(commandRec, DrawTreeCoordinator.class, null);        if (treeDrawCoordTask == null)			         return false;        numberTask= (NumberForTree)hireEmployee(commandRec, NumberForTree.class, &quot;Number to calculate&quot;);        makeMenu(&quot;Baby&quot;);        addSubmenu(null, &quot;Number to calculate&quot;, makeCommand(&quot;setNumberTask&quot;,  this), NumberForTree.class);        addMenuItem( &quot;-&quot;, null);        bTreeWindow= new BTreeWindow( this, treeDrawCoordTask, numberTask);        setModuleWindow(bTreeWindow);        if (!commandRec.scripting())             bTreeWindow.setVisible(true);        resetAllMenuBars();        return true;    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*A method that is called when an employee quits for some reason.  Can be used to respond appropriately.</font>  	 public void employeeQuit(MesquiteModule m){  	 	if (m==numberTask) {  	 		numberTask = null;			bTreeWindow.setNumberTask(null, CommandRecord.nonscriptingRecord);  	 		resetContainingMenuBar();  	 	}  	 	else  	 		iQuit();  	 }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*A method necessary with modules of subclass TreeWindowAssistantN; allows standard tree window</font><font color="red">    on which this module depends to indicate tree has changed  <b>(overrides method of TreeWindowAssistantN)</b>*/</font>    public void <b>setTree</b>(Tree tree, CommandRecord commandRec) {        bTreeWindow.setTree(tree, commandRec);    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*Makes the module shut down when the go-away box of the window is touched  <b>(overrides method of MesquiteModule)</b>*/</font>     public void <b>windowGoAway</b>(MesquiteWindow whichWindow) {        whichWindow.hide();        whichWindow.dispose();        iQuit();    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*Returns the snapshot necessary to get this module back to the current state.  Note that it incorporates</font><font color="red">      a snapshot from its window  <b>(overrides method of MesquiteModule)</b>*/</font>    public Snapshot <b>getSnapshot</b>(MesquiteFile file) {        if (bTreeWindow ==null)           return null;        Snapshot fromWindow = bTreeWindow.getSnapshot(file);        if (fromWindow == null || fromWindow.getNumLines() ==0)            return null;        Snapshot sn = new Snapshot();        sn.addLine(&quot;getWindow&quot;);        sn.addLine(&quot;tell It&quot;);        sn.incorporate(fromWindow, true);        sn.addLine(&quot;endTell&quot;);        sn.addLine(&quot;getTreeDrawCoordinator&quot;, treeDrawCoordTask);        sn.addLine(&quot;setNumberTask&quot;, numberTask);        sn.addLine(&quot;showWindow&quot;);        return sn;    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*The standard method for Commandable interface; receives commands either for snapshotting purposes</font><font color="red">      or from menu actions  <b>(overrides method of MesquiteModule)</b>*/</font>    public Object <b>doCommand</b>(String commandName, String arguments, CommandRecord commandRec, CommandChecker checker) {        if (checker.compare(this.getClass(), &quot;Returns the module serving as the window's draw tree coordinator&quot;, null, commandName, &quot;getTreeDrawCoordinator&quot;))            return treeDrawCoordTask;        else if (checker.compare(this.getClass(), &quot;Sets which module class should calculate a number for the tree&quot;, &quot;[name of module]&quot;, commandName, &quot;setNumberTask&quot;)) {            NumberForTree temp= (NumberForTree)replaceEmployee(commandRec, NumberForTree.class, arguments, null, numberTask);            if (temp!=null) {                numberTask = temp;                bTreeWindow.setNumberTask(numberTask, commandRec);                resetContainingMenuBar();                return numberTask;            }        }        else 			return super.doCommand(commandName, arguments, commandRec, checker);        return null;    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*Receives message from employees that their parameters have changed an recalculation may be needed  <b>(overrides method of MesquiteModule)</b>*/</font>    public void <b>employeeParametersChanged</b>(MesquiteModule employee, MesquiteModule source, CommandRecord commandRec) {        if (employee== numberTask)            bTreeWindow.recalculate(commandRec);    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*Indicates to the name of this module for purposes of menu listings and documentation.  <b>(overrides method of MesquiteModule)</b>*/</font>    public String <b>getName</b>() {        return &quot;Baby Tree Window (example module)&quot;;    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*Returns an explanation of what the module does.  <b>(overrides method of MesquiteModule)</b>*/</font>    public String <b>getExplanation</b>() {        return &quot;Displays a single tree (the same as in a tree window).&quot; ;    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*Returns the authors of the module.  <b>(overrides method of MesquiteModule)</b>*/</font>    public String <b>getAuthors</b>() {        return &quot;Wayne Maddison and David Maddison&quot;;    }}    <font color="red"><b>/*========================================*/</b></font><font color="red">/*The window (Frame) itself shown on the screen, containing a tree that is the same as the one in the standard tree window*/</font>public class <b>BTreeWindow</b> extends MesquiteWindow  {    TreeDisplay treeDisplay;    DrawTreeCoordinator treeDrawCoordTask;    TextField p;    MesquiteNumber num = new MesquiteNumber();    NumberForTree numberTask;    Tree tree;        public <b>BTreeWindow</b> (BabyTreeWindow ownerModule, DrawTreeCoordinator treeDrawCoordTask, NumberForTree numberTask){        super(ownerModule, true);         this.treeDrawCoordTask = treeDrawCoordTask;        this.numberTask = numberTask;        setWindowSize(500,400);        setBackground(Color.white);        p = new TextField();        p.setBackground(Color.yellow);        addToWindow(p);        resetTitle();    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /* Used to get the title for window <b>(overrides abstract method of MesquiteWindow)</b>*/</font>    public void <b>resetTitle</b>(){        setTitle(&quot;Baby Tree Window&quot;);     }    <font color="red">/*--------------------------------------*/</font><font color="red">    /* Resize the tree display and other components.*/</font>    public void <b>sizeDisplays</b>(){        if (treeDisplay==null) return;        int totalWidth = getWidth();        int totalHeight = getHeight() - 30;        treeDisplay.setSize(totalWidth,totalHeight);        treeDisplay.setFieldSize(totalWidth,totalHeight);      		if (p!=null)            p.setBounds(0,totalHeight, totalWidth, 30);    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*Sets the tree to be shown in the window.*/</font>    public void <b>setTree</b>(Tree newTree, CommandRecord commandRec){        if (treeDisplay == null) {            Taxa taxa = newTree.getTaxa();            treeDisplay =treeDrawCoordTask.createOneTreeDisplay(taxa, this, commandRec);             addToWindow(treeDisplay);            treeDisplay.setLocation(0,0);            sizeDisplays();        }                if (treeDisplay.getTree()!=null)            treeDisplay.getTree().dispose();        if (newTree!=null) {            tree = newTree.cloneTree();            treeDrawCoordTask.setTreeOfOneDisplay(tree);            recalculate(commandRec);            treeDisplay.suppressDrawing(false);            treeDisplay.setVisible(true);            treeDisplay.repaint();        }    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*Sets what module is to be used for calculating the number for the tree*/</font>    public void <b>setNumberTask</b>(NumberForTree numTask, CommandRecord commandRec){        numberTask = numTask;        recalculate(commandRec);    }<font color="red">    /*--------------------------------------*/</font><font color="red">    /*Recalculates the number for the tree*/</font>    public void <b>recalculate</b>(CommandRecord commandRec){        if (numberTask!=null &amp;&amp; tree !=null){            numberTask.calculateNumber(tree, num, commandRec);            p.setText(numberTask.getName() + &quot; &quot; + num);        }      		else         			p.setText(&quot;&quot;);    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*Sets the size of the window (setSize and setBounds should not be used!!!&gt;  <b>(overrides method of MesquiteWindow)</b>*/</font>    public void <b>setWindowSize</b>(int w, int h){        super.setWindowSize(w,h);        sizeDisplays();    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /* Called when the window has been resized, e.g. by user. <b>(overrides method of MesquiteWindow)</b>*/</font>    public void <b>windowResized</b>(){        sizeDisplays();    }    <font color="red">/*--------------------------------------*/</font><font color="red">    /*Disposes of the window*/</font>    public void <b>dispose</b>(){        if (treeDisplay!=null){            if (treeDisplay.getTree()!=null)                treeDisplay.getTree().dispose();            treeDisplay.dispose();        }        super.dispose();    }}</pre>		<p>		<hr>		&copy; W. Maddison &amp; D. Maddison 2000-2005</p>		<p>&nbsp;	</body></html>